extends layout

block page_scripts
  script(src="//cdnjs.cloudflare.com/ajax/libs/parsley.js/2.1.2/parsley.min.js")

block main
  div(id="Home").Site-transform

    - var intro_data = contents.home['home_pupil_intro.json']
    - var intro_meta = intro_data.metadata    
    - var oss_data = contents.home['home_open_source.json']
    - var oss_meta = oss_data.metadata
    - var home_newsletter = contents.home['home_newsletter.json']
    - var home_newsletter_meta = home_newsletter.metadata
    - var customer_data = contents.home['customer_list.json']
    - var customer_meta = customer_data.metadata
    - var commercial_meta = customer_meta.commercial
    - var academic_meta = customer_meta.academic
    - var customer_meta = commercial_meta.concat(academic_meta)

    //- show background image
    div.Background-img-top.Background-img-cover
      figure(class="img-placeholder")
        div(class="Background-img--full-wh img-loaded img-small" style="background-image: url('data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAUAAD/4QMbaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlDNUQ2QTcwNUFCRjExRTZBNzMxQjg5Q0RDOTU0NUI2IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlDNUQ2QTZGNUFCRjExRTZBNzMxQjg5Q0RDOTU0NUI2IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgTWFjaW50b3NoIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9IkQ3NEIxQzI5QkJFOTMxNTVFRTIzNThCNkE5NzM4QTE5IiBzdFJlZjpkb2N1bWVudElEPSJENzRCMUMyOUJCRTkzMTU1RUUyMzU4QjZBOTczOEExOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABIODg4QDhUQEBUeFBEUHiMaFRUaIyIZGRoZGSInHiMhISMeJycuMDMwLic+PkFBPj5BQUFBQUFBQUFBQUFBQUEBFBQUFhkWGxcXGxoWGhYaIRodHRohMSEhJCEhMT4tJycnJy0+ODszMzM7OEFBPj5BQUFBQUFBQUFBQUFBQUFBQf/AABEIAB4AKAMBIgACEQEDEQH/xAB4AAADAQEBAAAAAAAAAAAAAAAABAUGAgMBAQEBAQAAAAAAAAAAAAAAAAIBAAMQAAIBAwMCAwUJAAAAAAAAAAECAwARBCExEkEFUSITYaEyFQZxgZGxwUKiIxQRAAICAgEFAAAAAAAAAAAAAAABETEhAmFBURIDE//aAAwDAQACEQMRAD8AjN3dCSWj1O50p3D+oZIEZEjATpemIvp7B4cnk99q7XsmBIvEORY2vcaVzXEgfrxYlNnOh/0Swuol+FteLfZyWpWU7zv6gTiNtrflWozsdExB22Qn9rpKdQ5uduW1qQ+XNHxjWQgMbDQbmk9m7ZfmlRnI24tqAR7aKu5HYcaABmmOp2FqKkm8XJ6R9uy3iHqlr+BJA/CmlxGXt8itII2AZi3gRt1v0rQEydQPdUSxXJyvVLvjNz5WsEQEef4xrb2U9U56G3o7gXliRQdwQseIdZlBLR8hfcClpMTNgPrLKMmK/wDWwu38RfWrEfzKNI1i4zR20c+Q8beXTxoY5By7RgjyN6rR2sG6crffvVa7tMmjfKMnmLnZLDnsuwCkfpRWv82nj76KOBw5s//Z');")
        
        div(class="Background-img--full-wh img-large" data-src="../media/images/home/slides/00.jpg")   
      div(style="top:55%;").Site-content-container.Background-img-caption-container.u-textCenter
        h1.Background-img-caption Open source eye tracking.
        //- h2.Background-img--caption-h2 

    include includes/webp-img
    //- pupil intro row
    div(id="content-top" class="Site-content-container")
      div.Feature-container-column
        div.Grid.Grid--justifyCenter.Grid--center.Grid--alignContentCenter.Feature-row
          div.Grid-cell.Grid-cell--full
            h1 Pupil Platform
            h3 We develop open source software and build accessible hardware for eye tracking.
          div.Grid-cell.Grid-cell--full
            div.Grid.Grid--1of2.Grid--justifyCenter.Grid--center.Grid--alignContentCenter
              div.Grid-cell
                p Our #[a(href="/pupil" title="Pupil mobile eye tracking headset") mobile eye tracking headsets] have research grade specs and enable accessible and scalable eye tracking research.
                p Supercharge your #[a(href="/vr-ar" title="Eye tracking for VR and AR") VR and AR eye tracking] research and development with our eye tracking add-ons for the latest consumer hardware.
                p Take full control of the software and modify to your needs - it's 100% open source!
                p All hardware is designed, developed, and assembled in our Berlin office and ships worldwide. Check out products on our #[a(href="/store" title="Pupil Labs store") store]. 
              div.Grid-cell
                figure.Feature-figure.u-padBottom--1
                  +webp-img("/media/images/home/platform/eye_debug_01_opaque.png", "Binocular 3D gaze mapper", "Binocular 3D gaze mapper")

    //- oss motivation row
    div.Site-gray-bkg
      div.Site-content-container
        div.Feature-container-column
          div.Grid.Grid--justifyCenter.Grid--center.Grid--alignContentCenter.Feature-row
            div.Grid-cell.Grid-cell--full.u-textCenter
              div.Feature
                h1 Pupil is Open Source
            div.Grid-cell.Grid-cell--full
              div.Grid.Grid--1of3.u-textCenter.u-padBottom--2
                div.Grid-cell
                  figure.Feature-figure
                    include includes/svg/modular_tools_svg
                  h4 #{ oss_meta.point1 }
                div.Grid-cell
                  figure.Feature-figure
                    include includes/svg/community_network_svg
                  h4 #{ oss_meta.point2 }
                div.Grid-cell
                  figure.Feature-figure
                    include includes/svg/support_infinity_svg                  
                  h4 #{ oss_meta.point3 }


              div.Grid-cell.Grid-cell--full.u-textCenter.u-padBottom--1
                div.Feature.u-padBottom--1
                  h3 The entire platform is on #[a(href="https://github.com/pupil-labs" title="Pupil repository on github") github] and licensed under LGPLv3.

                div.Feature.u-padBottom--1
                  h3 Chat with community and developers on
                  a(href="https://discordapp.com/invite/gKmmGqy")
                    button.Button.Button-submit-newsletter(style="width:300px;margin:auto;") Discord

                div.Feature.u-padTop--1
                  h3.u-padBottom--0 Check out a snapshot of the most recent activity below.

              div(style="border-bottom: 2px #ddd solid")
            div.Grid-cell.Grid-cell--full.u-padTop--1
              div(id="Home-activity")
                ul(id="Home-activity-list" class="Activity")

    //- companies and universities using pupil
    div.Site-content-container
      a(name="featured-users")
      div.Feature-container-column
        div.Grid.Grid--justifyCenter.Grid--center.Grid--alignContentCenter.Feature-row
          div.Grid-cell.Grid-cell--full.u-textCenter.u-padBottom--2(style="border-bottom:1px solid grey;")
            div.Feature.u-padBottom--2
              h1 Featured companies and universities using Pupil

            - var commercial_filtered = _.filter(commercial_meta, function(obj){return obj.img.length > 0;});
            - var commercial_sorted = _.sortBy(commercial_filtered, function(obj){return obj.weight;}).reverse();
            - var company_desktop = _.first(commercial_sorted, 8)
            - var company_mobile = _.first(commercial_sorted, 6)

            div.Grid.Grid--1of4.Grid--gutters.Customer-desktop
              each comp_desktop,i in company_desktop
                div.Grid-cell(style="align-self:center;")
                  picture(id= comp_desktop.uid)
                    img(src= comp_desktop.img)

            div.Grid.Grid--1of4.Grid--gutters.Customer-mobile
              each comp_mobile,i in company_mobile
                div.Grid-cell.Grid--justifyCenter(style="align-self:center;")
                  picture(id= comp_mobile.uid)
                    img(src= comp_mobile.img)

          div.Grid-cell.Grid-cell--full.u-textCenter.u-padBottom--2
            div.Feature.u-padBottom--2
              
            - var academic_filtered = _.filter(academic_meta, function(obj){return obj.img.length > 0;});
            - var academic_sorted = _.sortBy(academic_filtered, function(obj){return obj.weight;}).reverse();
            - var edu_desktop = _.first(academic_sorted, 8)
            - var edu_mobile = _.first(academic_sorted, 6)

            div.Grid.Grid--1of4.Grid--gutters.Customer-desktop
              each academic_desktop ,i in edu_desktop
                div.Grid-cell(style="align-self:center;")
                  picture(id= academic_desktop.uid)
                    img(src= academic_desktop.img)

            div.Grid.Grid--1of4.Grid--gutters.Customer-mobile
              each academic_desktop ,i in edu_mobile
                div.Grid-cell.Grid--justifyCenter(style="align-self:center;")
                  picture(id= academic_desktop.uid)
                    img(src= academic_desktop.img)

          div.Grid-cell.Grid-cell--full.u-textCenter.u-padTop--2
            div.Feature
              h3 Take a look at academic #[a(href="https://docs.google.com/spreadsheets/d/1ZD6HDbjzrtRNB4VB0b7GFMaXVGKZYeI0zBOBEEPwvBI/edit?ts=576a3b27#gid=0" title="publications that cite Pupil") publications that cite Pupil].

    div.Site-gray-bkg
      div.Site-content-container
        div.Feature-container-column
          div.Grid.Grid--justifyCenter.Grid--center.Grid--alignContentCenter.Feature-row
            div.Grid-cell.Grid-cell--full
              div.Feature
                h1.u-textCenter Recent Blog Posts
            div.Grid-cell.Grid-cell--full.u-padTop--2
              ul
              - var articles = env.helpers.getArticles(contents)
              - var articleLimit = 5
              each article,i in articles.slice(0,articleLimit)
                - var opacity = "opacity:"+String(1-(i*(1.1/articleLimit)))+";"
                li(class="Article-list-item" style=opacity)
                  article
                    header
                      h4 #{ article.title } - #[time(class="Article-time")= moment.utc(article.date).format('YYYY MMM. DD')]
                      p= article.metadata.subtitle
                      a(href=article.url class="Article-link") Read More 

    //- newsletter row
    div.Site-content-container
      div.Feature-container-column
        div.Grid.Grid--justifyCenter.Grid--center.Grid--alignContentCenter.Feature-row
          div.Grid-cell.Grid-cell--full
            div.Feature
              h1.u-textCenter #{ home_newsletter_meta.title }
          div.Grid-cell.Grid-cell--full
            div.Grid
              div.Grid-cell.Grid-cell--full
                h4 #{ home_newsletter_meta.point1 }
              div(style="flex:1 0;")
                form(id="newsletter-form" data-parsley-validate data-parsley-focus="first")
                  label(class="Form-hidden" for="mce-EMAIL") email
                  input(class="Form-input Form-input--text-newsletter" id="mce-EMAIL" type="email" placeholder="#{ home_newsletter_meta.input_placeholder }" name="EMAIL" required data-parsley-trigger="focusout" data-parsley-errors-container="#news_email_error")
                  p(class="Form-error--text" id="news_email_error")
                  label(class="Form-hidden" for="newsletter-form-submit") submit             
                  input(type="submit" value="submit" id="newsletter-form-submit" class="Form-input--submit")
                  label(for="newsletter-form-submit" class="Button Button--cart Button-submit-newsletter") #{ home_newsletter_meta.button }